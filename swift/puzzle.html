<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>经典数字拼图实现 | sofent blog</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.c3210e46.css">
    <link rel="modulepreload" href="/assets/app.b7621b69.js">
    <link rel="modulepreload" href="/assets/swift_puzzle.md.0b30accf.lean.js">
    
    <meta name="twitter:title" content="经典数字拼图实现 | sofent blog">
  <meta property="og:title" content="经典数字拼图实现 | sofent blog">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="sofent blog, back to home" data-v-675d8756 data-v-cc01ef16><!----> sofent blog</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/sofent" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>My Repo <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/sofent" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>My Repo <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">技术杂谈</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/git">git相关</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">SwiftUI</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/swift/swiftui">SwiftUI学习</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/swift/puzzle">数字拼图</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#简介">简介</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#实现界面">实现界面</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#实现逻辑">实现逻辑</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#初始化拼图">初始化拼图</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#玩法实现">玩法实现</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义图片">自定义图片</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#添加游戏计时">添加游戏计时</a><!----></li></ul></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Nas风云</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/nas/aliyun">阿里云盘挂载</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">博客相关</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/vitepress">VitePress</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/githubio">GithubIO</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/autodeploy">自动化部署</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="经典数字拼图实现" tabindex="-1">经典数字拼图实现 <a class="header-anchor" href="#经典数字拼图实现" aria-hidden="true">#</a></h1><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-hidden="true">#</a></h2><p>最近看到小朋友买了一个拼图板,但却不怎么会玩。想教她玩去发现这个玩具质感有点差，操作时经常卡住。而且由于一个图片，不便于讲解解法，所以想写一个程序来模拟。 <img src="/assets/puzzle.d0ac7a19.jpeg" alt=""></p><p>打算实现的效果如下</p><p><img src="/assets/puzzledest.4d5edd76.png" alt=""></p><p>可以过程向滑动来控制方块的移动，当解题成功的时候能弹出正确的提示。</p><h2 id="实现界面" tabindex="-1">实现界面 <a class="header-anchor" href="#实现界面" aria-hidden="true">#</a></h2><p>我们实现的是一个4x4的正方形格子，每个格子是一个数字，我们需要先实现一个格子的格式.我们简单实现，一个棕色背景上用一个白色的数字。这里的大小我们也写死了50。其实这里应该可以通过屏幕尺寸计算合理大小，在留相应边界的情况下取1/4.然后我们通过将数字为0的时候不透明度设置为0来模拟这个方块是个空白。</p><div class="language-swift"><pre><code> <span class="token attribute atrule">@ViewBuilder</span> <span class="token keyword">func</span> <span class="token function-definition function">CellView</span><span class="token punctuation">(</span>number<span class="token punctuation">:</span><span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword">some</span> <span class="token class-name">View</span><span class="token punctuation">{</span>
        <span class="token class-name">VStack</span><span class="token punctuation">{</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">number</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">.</span>brown<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span>number<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>上面实现的是一个简单的版本，直接用Text实现，通过font来控制大小，但这样还是不够灵活。所以后面实现了另外一个版本的格子。同时也支持自定义图片.这个版本当有自定义图片的时候，使用对应数字自定义图片。当没有自定义图片时，使用SF Symbol中的矢量图片来实现，方便适配各各大小的格子尺寸。同时实现的图片格子大小根据屏幕大小的自适应。（更进一步，应该可以使用<code>GeometryReader</code>）</p><div class="language-swift"><pre><code> <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">UIScreen</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token class-name">UIScreen</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.8</span> <span class="token operator">-</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span>
<span class="token attribute atrule">@ViewBuilder</span> <span class="token keyword">func</span> <span class="token function-definition function">CellView</span><span class="token punctuation">(</span>number<span class="token punctuation">:</span><span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword">some</span> <span class="token class-name">View</span><span class="token punctuation">{</span>
        
        <span class="token class-name">VStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> image <span class="token operator">!=</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>uiImage<span class="token punctuation">:</span> number <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> puzzleImages<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> puzzleImages <span class="token punctuation">[</span>number <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">aspectRatio</span><span class="token punctuation">(</span>contentMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>fill<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">clipped</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">number</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">.square.fill&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>brown<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span>number<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>实现了一个格子的样子，我们来实现整个游戏区域的样子.这里我们定义了一个数组，用来存放每个格子上显示的数字。</p><div class="language-swift"><pre><code>  <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> puzzle<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token comment">//code in body</span>
 <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">...</span><span class="token number">3</span><span class="token punctuation">,</span>id<span class="token punctuation">:</span><span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">{</span>nx <span class="token keyword">in</span>
                <span class="token class-name">HStack</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">...</span><span class="token number">3</span><span class="token punctuation">,</span>id<span class="token punctuation">:</span><span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">{</span>ny <span class="token keyword">in</span>
                        <span class="token class-name">CellView</span><span class="token punctuation">(</span>number<span class="token punctuation">:</span> puzzle<span class="token punctuation">[</span><span class="token punctuation">(</span>nx<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>ny<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">border</span><span class="token punctuation">(</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span>width<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><p>至此一个简单的数字拼图大体的样子已经基本实现。</p><h2 id="实现逻辑" tabindex="-1">实现逻辑 <a class="header-anchor" href="#实现逻辑" aria-hidden="true">#</a></h2><h3 id="初始化拼图" tabindex="-1">初始化拼图 <a class="header-anchor" href="#初始化拼图" aria-hidden="true">#</a></h3><p>刚才我们实现的拼图，显示的数字是顺序的1到16.和我们期望的16为空格不同。初始的拼图的目的就是为了有一个打算顺序的拼图。当然简单打乱顺序，可以粗暴地使用数组的交换来实现。但这样会导致初始化的拼图不一定能拼成我们期望的图案。所以我们最好是通过老实的移动空格子来打算整个棋盘。这里我们初始化的方法是将空格子移动128次（因为条件限制，不并是都会真的发生移动）</p><div class="language-swift"><pre><code>    <span class="token keyword">func</span> <span class="token function-definition function">initPuzzle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> puzzle <span class="token operator">=</span>  <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">16</span><span class="token punctuation">)</span>
        puzzle<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">128</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token function">move</span><span class="token punctuation">(</span><span class="token class-name">Direction</span><span class="token punctuation">.</span>allCases<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">:</span> <span class="token operator">&amp;</span>puzzle<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">print</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>puzzle <span class="token operator">=</span> puzzle
    <span class="token punctuation">}</span>
</code></pre></div><p>下面我们来实现移动的逻辑，这个逻辑也不复杂，左右就交换顺序，上下就交换行。只需要保证是在可移动的范围即可。</p><div class="language-swift"><pre><code>
<span class="token keyword">enum</span> <span class="token class-name">Direction</span><span class="token punctuation">:</span><span class="token class-name">CaseIterable</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> up
    <span class="token keyword">case</span> down
    <span class="token keyword">case</span> <span class="token keyword">left</span>
    <span class="token keyword">case</span> <span class="token keyword">right</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">move</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> dir<span class="token punctuation">:</span><span class="token class-name">Direction</span><span class="token punctuation">,</span>  puzzle<span class="token punctuation">:</span><span class="token keyword">inout</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> zeroindex <span class="token operator">=</span> puzzle<span class="token punctuation">.</span><span class="token function">firstIndex</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">!</span>
        <span class="token keyword">switch</span> dir <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>up<span class="token punctuation">,</span><span class="token punctuation">.</span>down<span class="token punctuation">:</span>
            <span class="token keyword">let</span> destIndex <span class="token operator">=</span> dir <span class="token operator">==</span> <span class="token punctuation">.</span>up <span class="token operator">?</span> zeroindex <span class="token operator">+</span> <span class="token number">4</span> <span class="token punctuation">:</span> zeroindex <span class="token operator">-</span> <span class="token number">4</span>
            <span class="token keyword">if</span> destIndex <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> destIndex <span class="token operator">&lt;=</span> <span class="token number">15</span> <span class="token punctuation">{</span>
                puzzle<span class="token punctuation">.</span><span class="token function">swapAt</span><span class="token punctuation">(</span>zeroindex<span class="token punctuation">,</span> destIndex<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">left</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>zeroindex <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span> <span class="token punctuation">{</span>
                puzzle<span class="token punctuation">.</span><span class="token function">swapAt</span><span class="token punctuation">(</span>zeroindex<span class="token punctuation">,</span> zeroindex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token keyword">right</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>zeroindex <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
                puzzle<span class="token punctuation">.</span><span class="token function">swapAt</span><span class="token punctuation">(</span>zeroindex<span class="token punctuation">,</span> zeroindex<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>至此，我们实现了一个乱序的puzzle数组的方法。只需要在页面展示的时候调用这个方法来初始化棋盘即可。</p><div class="language-swift"><pre><code> <span class="token punctuation">.</span>onAppear<span class="token punctuation">{</span>
                <span class="token function">initPuzzle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
</code></pre></div><h2 id="玩法实现" tabindex="-1">玩法实现 <a class="header-anchor" href="#玩法实现" aria-hidden="true">#</a></h2><p>我们实现的逻辑比较简单，只要在整个棋盘任何位置上滑动，判断滑动的方向。来实现空格子旁边的元素移动即可。由于前面我们已经在初始棋盘的时候实现了移动格子位置的逻辑。所以我们只需要实现监控滑动事件即可，这里我们通过一个拖动的动作来实现</p><div class="language-swift"><pre><code> <span class="token punctuation">.</span><span class="token function">gesture</span><span class="token punctuation">(</span><span class="token class-name">DragGesture</span><span class="token punctuation">(</span>minimumDistance<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> coordinateSpace<span class="token punctuation">:</span> <span class="token punctuation">.</span>global<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span>onEnded <span class="token punctuation">{</span> value <span class="token keyword">in</span>
                            
                            <span class="token keyword">let</span> horizontalAmount <span class="token operator">=</span> value<span class="token punctuation">.</span>translation<span class="token punctuation">.</span>width <span class="token keyword">as</span> <span class="token class-name">CGFloat</span>
                            <span class="token keyword">let</span> verticalAmount <span class="token operator">=</span> value<span class="token punctuation">.</span>translation<span class="token punctuation">.</span>height <span class="token keyword">as</span> <span class="token class-name">CGFloat</span>
                            <span class="token keyword">var</span> puzzle <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>puzzle
                            <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span>horizontalAmount<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">abs</span><span class="token punctuation">(</span>verticalAmount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token function">print</span><span class="token punctuation">(</span>horizontalAmount <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">&quot;left swipe&quot;</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;right swipe&quot;</span></span><span class="token punctuation">)</span>
                                <span class="token function">move</span><span class="token punctuation">(</span>horizontalAmount <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">.</span><span class="token keyword">left</span> <span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">right</span><span class="token punctuation">,</span>puzzle<span class="token punctuation">:</span> <span class="token operator">&amp;</span>puzzle<span class="token punctuation">)</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                <span class="token function">print</span><span class="token punctuation">(</span>verticalAmount <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">&quot;up swipe&quot;</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;down swipe&quot;</span></span><span class="token punctuation">)</span>
                                <span class="token function">move</span><span class="token punctuation">(</span>verticalAmount <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">.</span>up <span class="token punctuation">:</span> <span class="token punctuation">.</span>down<span class="token punctuation">,</span>puzzle<span class="token punctuation">:</span> <span class="token operator">&amp;</span>puzzle<span class="token punctuation">)</span>
                            <span class="token punctuation">}</span>
                            <span class="token keyword">if</span> puzzle <span class="token operator">!=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>puzzle <span class="token punctuation">{</span>
                                <span class="token keyword">self</span><span class="token punctuation">.</span>puzzle <span class="token operator">=</span> puzzle
                            <span class="token punctuation">}</span>
                           
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>格子移动实现之后，我们只需要在每次格子移动的时候判断一下当前棋盘是不是已经正确排列即可，当正确排列后，我们将游戏胜利设置为true。三秒中之后自动重新开始下一局：</p><div class="language-swift"><pre><code> <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> puzzle<span class="token punctuation">)</span><span class="token punctuation">{</span> p <span class="token keyword">in</span>
                            <span class="token keyword">var</span> winArray <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">16</span><span class="token punctuation">)</span>
                            winArray<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
                            <span class="token keyword">if</span> p <span class="token operator">==</span> winArray <span class="token punctuation">{</span>
                                win <span class="token operator">=</span> <span class="token boolean">true</span>
                                <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">asyncAfter</span><span class="token punctuation">(</span>deadline<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    win <span class="token operator">=</span> <span class="token boolean">false</span>
                                    <span class="token function">initPuzzle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
</code></pre></div><p>当游戏胜利，我们展示一个胜利的提示，这里直接在棋盘上overlay一个文本提示来实现。同时棋盘设置为模糊，以获取更好的效果。</p><div class="language-swift"><pre><code><span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> win <span class="token operator">?</span> <span class="token number">5</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>overlay<span class="token punctuation">{</span>
                <span class="token keyword">if</span> win <span class="token punctuation">{</span>
                    <span class="token class-name">VStack</span><span class="token punctuation">{</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;拼图成功&quot;</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ultraThinMaterial<span class="token punctuation">,</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
</code></pre></div><p>至此一个简单的数字拼图小游戏就实现了，完整的代码可以在<a href="https://github.com/sofent/CountGround/blob/main/CountGround/ClassicPuzzle.swift" target="_blank" rel="noopener noreferrer">这里</a>查看。代码还有非常多可以优化的地方，除了刚才提到<s>格子大小问题</s>，还有<s>格子实现自定义棋盘大小</s>，实现<s>自定义拼图图片</s>，实现格子交换的动画效果，实现胜利提示的动画效果等。由于时间原因，这里就不展开了。</p><h2 id="自定义图片" tabindex="-1">自定义图片 <a class="header-anchor" href="#自定义图片" aria-hidden="true">#</a></h2><p>实现自定义图片也不复杂，我们添加一个按钮来触发图片选择. 同时也实现重新开始以及清除图片的功能。逻辑比较简单，看代码即可</p><div class="language-swift"><pre><code> <span class="token class-name">VStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> image <span class="token operator">!=</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Image</span><span class="token punctuation">(</span>uiImage<span class="token punctuation">:</span> image<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">toSquare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">scaledToFill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;选择图片&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>showImagePicker <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderedProminent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>vertical<span class="token punctuation">)</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;重新开始&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">initPuzzle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderedProminent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>vertical<span class="token punctuation">)</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;清除图片&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>image <span class="token operator">=</span> <span class="token nil constant">nil</span>
                    <span class="token function">initPuzzle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderedProminent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>vertical<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>image<span class="token operator">==</span><span class="token nil constant">nil</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>horizontal<span class="token punctuation">)</span>
</code></pre></div><p>图片选择实现一个抽屉即可,选择完图片，然后这里有一个重要步骤，就是把图片的方法重置统一重置为朝上，不然在切分图片的时候会发生行和列错乱的问题。 <code>fixedOrientation</code>具体要实现可以参考<a href="./swiftui.html#fixedOrientation">这里</a></p><div class="language-swift"><pre><code><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $showImagePicker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ImagePickerView</span><span class="token punctuation">(</span>sourceType<span class="token punctuation">:</span> <span class="token punctuation">.</span>photoLibrary<span class="token punctuation">)</span> <span class="token punctuation">{</span> image <span class="token keyword">in</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>image <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">fixedOrientation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token function">initPuzzle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre></div><h2 id="添加游戏计时" tabindex="-1">添加游戏计时 <a class="header-anchor" href="#添加游戏计时" aria-hidden="true">#</a></h2><p>我们希望在开始解题时进行计时，实时显示时间的消耗。在拼图完成的时候，显示耗时多少。 对于计时，我们使用<code>TimelineView</code>来实现。为了保证游戏区域不跳变，在未计时显示一个占位Text。 <code>TimelineView</code>设置为按秒更新，显示距离开始时间已消耗了多少秒</p><div class="language-swift"><pre><code> <span class="token keyword">if</span> <span class="token operator">!</span>win <span class="token operator">&amp;&amp;</span> startDate <span class="token operator">!=</span> <span class="token punctuation">.</span>distantPast <span class="token punctuation">{</span>
                    <span class="token class-name">TimelineView</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">periodic</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span><span class="token punctuation">.</span>now<span class="token punctuation">,</span> by<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> context <span class="token keyword">in</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span>&quot;已耗时<span class="token punctuation">:</span><span class="token punctuation">\</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">timeIntervalSince</span><span class="token punctuation">(</span>startDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>秒&quot;<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;未在计时&quot;</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
</code></pre></div><p>我们初始化的时候将startDate设置为<code>.distantPast</code>，然后这个来判断是不是始始值。当有滑动，并且导致puzzle实际发生了变化的时候，我们将它设置为当前时间。</p><div class="language-swift"><pre><code>                          <span class="token keyword">if</span> puzzle <span class="token operator">!=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>puzzle <span class="token punctuation">{</span>
                                <span class="token keyword">if</span> startDate <span class="token operator">==</span> <span class="token punctuation">.</span>distantPast<span class="token punctuation">{</span>
                                    startDate <span class="token operator">=</span> <span class="token punctuation">.</span>now
                                <span class="token punctuation">}</span>
                                <span class="token keyword">self</span><span class="token punctuation">.</span>puzzle <span class="token operator">=</span> puzzle
                            <span class="token punctuation">}</span>
</code></pre></div><p>修改拼图完成后的提示，加上已经共消耗的时间.</p><div class="language-swift"><pre><code>                            <span class="token class-name">VStack</span><span class="token punctuation">{</span>
                                <span class="token class-name">Text</span><span class="token punctuation">(</span>&quot;拼图成功<span class="token punctuation">\</span>n共耗时<span class="token punctuation">:</span><span class="token punctuation">\</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">timeIntervalSince</span><span class="token punctuation">(</span>startDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>秒&quot;<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">multilineTextAlignment</span><span class="token punctuation">(</span><span class="token punctuation">.</span>center<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">}</span>
                            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ultraThinMaterial<span class="token punctuation">,</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>至此基本完成了游戏耗时的统计。然后只需在<code>initPullzel()</code>将startDate重新设置为<code>.distantPast</code>，以保证下一局可以正确统计时间，就完成整个耗时统计的完整实现.</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/swift/swiftui" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>SwiftUI学习</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/nas/aliyun" data-v-38ede35f><span class="text" data-v-38ede35f>阿里云盘挂载</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_autodeploy.md\":\"4fac138e\",\"blog_githubio.md\":\"1e63d5e1\",\"blog_vitepress.md\":\"b4d26af5\",\"index.md\":\"184a0135\",\"nas_aliyun.md\":\"d8aea49b\",\"swift_puzzle.md\":\"0b30accf\",\"swift_swiftui.md\":\"946bbf86\",\"tech_git.md\":\"b8afd4e7\"}")</script>
    <script type="module" async src="/assets/app.b7621b69.js"></script>
    
  </body>
</html>